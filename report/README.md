## A Research on RISC-vs-CISC Debate

### 基本概况

| | |
| :---- | :--- |
| 题目  | Power struggles: Revisiting the RISC vs. CISC debate on contemporary ARM and x86 architectures  |
| 出处 |  Emily Blem; Jaikrishnan Menon; Karthikeyan Sankaralingam  |
| 日期 |  03 June 2013  |
| 关键词  | RISC, CISC, ARM architectures,x86 architectures, chip area, processor design complexity |

### 背景

在20世纪80年代和90年代，芯片的大小和设计的复杂度是主要的瓶颈与约束，所以关于指令集架构(ISA)的设计是一个重要的问题。在过去的十几年中，ARM架构(基于RISC-ISA)在移动端和低功耗嵌入式计算的领域占统治地位，而x86架构(基于CISC-ISA)在桌面端和服务器端是主流。

现如今芯片大小与设计复杂度已经不是主要约束，取而代之的是能源和功率的约束。而且，从商业的角度来看，两种ISA(RISC和CISC)都有在新的市场中出现，比如基于ARM架构的服务器、基于x86架构的手机。因此，有必要再进行一次RISC与CISC之间的比较。

### 目的

前人的研究比较了基于RISC( Reduced Instruction Set Computing)和CISC( Complex Instruction Set Computing)的指令集架构，发现RISC指令集有更好的性能(Bhandarkar & Clark, 1991)；一些非正式的研究也声称x86的CISC指令集架构导致了其功率的额外负荷，而把ARM处理器的低功率消耗归因于其RISC指令集架构。文章的目的是——从功率和能耗的角度，重新探讨RISC与CISC之间存在的争议。

### 原理及方法

在指令集架构的研究中，最大的难点在于——在ISA不同实现的基础上，如何分离出与ISA本身无关的因素。比如：内存带宽、操作系统、执行的工作负荷类型等。尤其是当考虑能耗上的分析时，芯片在不同的主板上会带来额外的挑战。

**原理**：找到有着相近微架构以及I/O和内存子系统的ISA实现，以分离出与实验目的无关的变量。

**方法**：

1. 对于ARM和x86架构分别考虑两种芯片实现，保证与处理器无关的特性尽量相同。

   ![1571126174688](C:\Users\FANG\AppData\Roaming\Typora\typora-user-images\1571126174688.png)

2. 使用Linux 2.6 LTS内核的操作系统，保证不同平台上操作系统带来的影响尽量相同。

3. 使用gcc 4.4编译器，并使用相同的编译器前端来生成二进制代码。对于ARM架构，禁用THUMB指令集，使之更接近RISC ISA。由于编译时的优化选项开启的是O3， 除了执行-O2所有的优化选项之外，还会采取向量化算法，提高代码的并行执行程度，利用现代CPU中的流水线、缓存等 ，所有的测试基准将不包含SIMD( Single Instruction Multiple Data)代码。

4. 选取多平台的工作负荷，包括移动端、桌面端、服务器端。

   ![1571129366460](C:\Users\FANG\AppData\Roaming\Typora\typora-user-images\1571129366460.png)

5. 性能分析：使用Linux上系统级性能分析工具perf，并使用时钟周期数来归一化频率的影响。并且

6. 功耗分析：将Wattsup监控仪表连接到主板的电源口，无网络连接，外设由另外独立电源供给，并关闭内核的动态电压频率调整(DVFS)，否则会根据芯片所运行的应用程序对计算能力的不同需要，动态调节芯片的运行频率和电压。如果有离群值出现，重新进行当前实验。

### 关键技术

1. 性能分析工具perf： Linux性能计数器是一个新的基于内核的子系统，它提供一个性能分析框架，比如硬件（CPU、PMU(Performance Monitoring Unit)）功能和软件(软件计数器、tracepoint)功能。通过perf，应用程序可以利用PMU、tracepoint和内核中的计数器来进行性能统计。
2. DynamoRIO动态测试工具 ：是一个进程级别的模拟软件，工作在应用和操作系统之间。其提供的API允许工具在目标程序执行时，观察和修改应用程序的实际代码流 。
3. BBench基准：移动端的芯片组通常会有专门的优化，而BBench是专门为智能手机设计的基准测试套件，使用跨平台的WebKit来模拟现实中的HTML渲染。
4. CoreMark基准： CoreMark是用来衡量嵌入式系统中中心处理单元(CPU或微控制器MCU)性能的标准。该标准于2009年由EEMBC组织的Shay Gla-On提出，并且试图将其发展成为工业标准，从而代替陈旧的Dhrystone标准。 其 测试方法很简单，就是在某配置参数组合下单位时间内跑了多少次CoreMark程序，其指标单位为CoreMark/MHz。CoreMark数字越高，意味着性能更高。 
5. SPECCPU2006基准： 是SPEC新一代的行业标准化的CPU测试基准套件， 提供了一个比较标准的计算密集型，高性能的跨硬件的CPU测试工具。在SPECCPU2006基准有几种不同的方法来衡量计算机性能。一种方式是测量计算机完成单一任务的速度; 另一种方式是吞吐量，容量或速率的测量。  
6. CloudSuite标准测试： 用于测试横横向扩展(scale-out)应用程序性能的标准测试程序集，涵盖了广泛的应用类别，包括：数据分析、数据缓存、数据服务、媒体流、软件测试、Web搜索、Web服务和图分析。

### 结论与发现

1. x86架构的指令平均周期数(CPI)小于ARM架构的CPI。
2. 性能的差异由微处理器体系结构(microarchitecture)决定，而不是指令集架构。
3. 功耗与微处理器体系结构的设计决策紧密相连。
4. 指令集架构是RISC还是CISC不决定现代处理器的功耗与性能。
5. 指令集架构所扮演的角色是在逐步发展中，能更好地支持特定类型任务。比如AVX指令集、虚拟化(virtualization)技术、硬件锁省略(HLE)、 事务性内存等。 

### 读书体会

该论文首先指令集架构设计的历史背景，然后通过对比过去与现今芯片的主要约束，认为有必要再一次探讨RISC与CISC两种指令集架构之间存在的争议。接着，作者介绍了前人对此相关的研究工作，提出本次研究最关键的问题是：指令集架构对功率和能耗的影响，以及指令集架构是否或如何影响性能与功率？然后又指出实验中存在最大的挑战是，在ISA不同实现的基础上，如何分离出与ISA本身无关的因素。

故在阅读该篇论文的过程中，我最大的收获便是其实验过程中严谨的方法论。这其中包括找到最大的难点、如何控制实验的变量、如何选取实验平台保证普适性、如何选取实验的指标参数、使用哪些(软/硬件)工具来进行对CPU和主板的测试、如何对实验结果进行分析等。作为一个以前没有多少机会阅读学术论文的学生，我同时也了解了如何阅读一篇论文，一篇学术论文大概的组织结构是怎样。在阅读一篇英文论文的过程中，一开始只能看懂文中一部分的内容，很多名词术语也不一定认识，所以只能在维基百科等地方进行相关资料搜集，对术语等有初步地了解，从而能渐渐地通读全文。

并且我还学到如何才能将实验结果更好地由图表来可视化展示。就比如该论文中，作者不仅使用柱状图、权衡曲线(trade-off curve)等来呈现实验结果，还使用多个表格将每一小点的发现汇总起来，既方便读者挑重点阅读，也方便自己有条理地得出最终结论。

### 推广应用

单纯一种指令集架构不会对性能和功耗等带来本质上的提升，就如MIPS、ARM和x86架构实现只是针对不同性能级别优化的设计。而我们可以通过对硬件架构与指令集架构进行组合设计，来得到一个更好的整体架构。

### 不足

1. 论文本来主要想研究指令集架构对功率和能耗的影响，但在实验中呈现的数据更多是在性能方面上的度量。
2. 论文指出i7消耗的功率确实更大，而这是其面向性能优化的内核导致的，而不是指令架构集。但文章并没有指出i7在性能上到底采取了什么不同的优化。
3. 论文指出Atom比Arm A9消耗的功率更低，但没有像上点说——为什么i7消耗的功率确实更大这样，分析其原因。

### 其他思考

在研究嵌入式领域时，我想最离不开的就是实验的支持；它不像提出算法可以全部都直接用理论推导证明，相反，只有大量实验才能更好地加强理解、证明所提出的理论。而实验过程中，严谨性十分重要；否则其他人换一个实验环境、平台，就有可能无法重现原文中的实验现象。 同时嵌入式作为一门与硬件息息相关的学科，随着硬件技术、工艺的发展，原来的经验理论不一定在当下适用；因此，我们也应该像这篇论文一样，以发展地观点来看待一个理论学说，并通过设计严谨的实验来对前人已有的理论进行改进、升华，最终得到自己的结论。

